{% load static %}
<!DOCTYPE html>
<html>
<head>

	<!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="{% static 'decision/main.css' %}">

    <script type="text/javascript" src="{% static "js/timerMain.js" %}"></script>
	{% if title %}
		<title>Trauma Overview - {{ title }}</title>
	{% else %}
		<title>Trauma Overview</title>
	{% endif %}
</head>
<body>
	<header class="site-header">
	  <nav class="navbar navbar-expand-md navbar-dark bg-steel fixed-top">
	    <div class="container">
	      <a class="navbar-brand mr-4" href="{% url 'decision-home' %}">TBS Decision App</a>
	      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggle" aria-controls="navbarToggle" aria-expanded="false" aria-label="Toggle navigation">
	      <span class="navbar-toggler-icon"></span>
	      </button>
	      <div class="collapse navbar-collapse" id="navbarToggle">
	        <div class="navbar-nav mr-auto">
	          <a class="nav-item nav-link" href="#">View Metrics</a>
	        </div>
	      </div>
	    </div>
	  </nav>
	</header>
	<main role="main" class="container">
        <h1>
             <!--
            ================================================================================
            Timer that displays time elapsed since beginning of Trauma
            ================================================================================
            -->
            <div class="container" id="timer">
               <label id="hours">00</label>:<label id="minutes">00</label>:<label id="seconds">00</label>
            <!--
            ================================================================================
            Javascript to create new timer for current session

            This script uses session storage variables to ensure that the time elapsed
            being displayed on the screen remain persistent with user navigation. If the user
            starts a session, let's it run for a bit, navigates away from the page, and then
            comes back the time elapsed is still accurate.
            ================================================================================
            -->

            <script >
                /*
                    If a new session has been started the total seconds elapsed is set to 0,
                    the start time is set to the current system time, and a new timer is started.
                    These values are then stored in web storage to be accesses later.
                 */
                if (localStorage.getItem('total_seconds_summary') === null){
                    var start = parseInt(localStorage.getItem('session_start'), 10);
                    var totSeconds = Math.floor((new Date().getTime() - start)/1000);
                    var navTime = 0;
                    var visTimer = new VisualTimer(start, totSeconds, navTime);
                    //console.log("Summary started " + totSeconds + " seconds after decision");
                    localStorage.setItem('total_seconds_summary', totSeconds.toString());
                    localStorage.setItem('nav_time_summary', navTime.toString());
                    setInterval(startVisTimer, 1000);
                }

                /*
                    If this is not a new session, the total seconds and start time are found
                    in session storage and used to create a new timer that is identical to the
                    old one. This ensure all data is preserved.
                 */
                else {
                    var totSeconds = parseInt(localStorage.getItem('total_seconds_summary'), 10);
                    var start = parseInt(localStorage.getItem('session_start'), 10);
                    var navTime = parseInt(localStorage.getItem('nav_time_summary'), 10);

                    var visTimer = new VisualTimer(start, totSeconds, navTime);
                    setInterval(startVisTimer, 1000);
                }

                /*
                    This function is repeated every second while the timer is running. It is
                    responsible for changing the timer displayed on the UI and saving the
                    updated total seconds elapsed to session storage. This ensures that this
                    value is always up to date as the user could navigate away from the page
                    at any time.
                 */
                function startVisTimer(){
                    visTimer.timerAnimate();
                    localStorage.setItem('total_seconds_summary', (visTimer.totalSeconds).toString());

                    /*
                        This simply saves the current time to ensure that we know exactly when the
                        user navigated away from the page. When the user navigates back to the page
                        this value will be used to calculate an accurate "total seconds" compensating
                        for the time spent away from the page.
                     */
                    var navTime = new Date().getTime();
                    console.log(navTime);
                    localStorage.setItem('nav_time_summary', navTime.toString());
                }
            </script>
          </div>
        </h1>
	  <div class="row">
	    <div class="col-md-8">
            <ul class="list-group">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                Step 1
                <span class="badge badge-primary badge-pill">00:00:45:00</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                Step 2
                <span class="badge badge-primary badge-pill">00:1:45:10</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                Step 3
                <span class="badge badge-primary badge-pill">00:00:15:07</span>
              </li>
            </ul>

	    </div>
	    <div class="col-md-4">
	      <div class="content-section">
	        <h3>Alerts</h3>
            <ul class="list-group list-group-flush">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                  <strong>Alert here</strong>
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                  <strong>Suggestion here</strong>
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              </li>
            </ul>
	      </div>
	    </div>
	  </div>
	</main>


	 <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>